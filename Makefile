# ------------------------------------------------------------------------------
#  GO tools
# ------------------------------------------------------------------------------
GO = go
# ------------------------------------------------------------------------------
# Tool variables
# ------------------------------------------------------------------------------
# f: force removal, v: verbose (list files removed)
RM = /bin/rm -fv

# ------------------------------------------------------------------------------
# Project Variables
# ------------------------------------------------------------------------------
PRG      = marcUtil
SRC      = cmd/marcUtil/main.go
MRC_FILE = examples/loc-header-only.mrc

# ------------------------------------------------------------------------------
#  Directory variables
# ------------------------------------------------------------------------------
DIR_BIN = $(CURDIR)/bin

# ------------------------------------------------------------------------------
# Make release targets
# ------------------------------------------------------------------------------
all: $(PRG)

$(PRG) : $(DIR_BIN)/$(PRG)

$(DIR_BIN)/$(PRG): $(SRC)
	$(GO) build -o $(DIR_BIN)/$(PRG) $^

$(DIR_BIN):
	@mkdir -p $(DIR_BIN)

run: $(PRG)
	$(DIR_BIN)/$(PRG) -f $(MRC_FILE)

test:
	$(GO) test cmd/$(PRG)/*.go -v

# ------------------------------------------------------------------------------
# General projet mainenance targets
# ------------------------------------------------------------------------------
.PHONEY: clean
clean:
	$(RM) $(DIR_BIN)/$(PRG)

cleaner:
	$(RM) -r $(DIR_BIN)
	

.PHONY: help
help:
	@grep -hE '^[ a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | \
		awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-17s\033[0m %s\n", $$1, $$2}'
